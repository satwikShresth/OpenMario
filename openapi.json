{
   "openapi": "3.0.0",
   "info": {
      "title": "Book Management API",
      "version": "1.0.0",
      "description": "API for managing books and authors"
   },
   "servers": [
      {
         "url": "http://localhost:3000/api"
      }
   ],
   "components": {
      "schemas": {
         "Book": {
            "type": "object",
            "properties": {
               "id": {
                  "type": "integer",
                  "minimum": -9007199254740991,
                  "maximum": 9007199254740991
               },
               "author_id": {
                  "type": "integer",
                  "minimum": -9007199254740991,
                  "maximum": 9007199254740991
               },
               "title": {
                  "type": "string"
               },
               "pub_year": {
                  "type": "string",
                  "maxLength": 4
               },
               "genre": {
                  "type": "string"
               }
            },
            "required": [
               "id",
               "author_id",
               "title",
               "pub_year",
               "genre"
            ],
            "description": "A book record with all its properties",
            "title": "Book"
         },
         "BookCreate": {
            "type": "object",
            "properties": {
               "id": {
                  "type": "integer",
                  "minimum": -9007199254740991,
                  "maximum": 9007199254740991
               },
               "author_id": {
                  "type": "integer",
                  "minimum": -9007199254740991,
                  "maximum": 9007199254740991
               },
               "title": {
                  "type": "string",
                  "minLength": 1,
                  "maxLength": 200,
                  "description": "The title of the book",
                  "example": "The Great Gatsby"
               },
               "pub_year": {
                  "type": "string",
                  "maxLength": 4,
                  "pattern": "^\\d{4}$",
                  "description": "The year the book was published",
                  "example": "2023"
               },
               "genre": {
                  "type": "string",
                  "minLength": 1,
                  "description": "The genre of the book",
                  "example": "Fiction",
                  "enum": [
                     "Fiction",
                     "Non-Fiction",
                     "Mystery",
                     "Science Fiction",
                     "Fantasy",
                     "Romance",
                     "Thriller",
                     "Horror",
                     "Biography",
                     "History",
                     "Science",
                     "Poetry",
                     "Drama",
                     "Children"
                  ]
               },
               "author_name": {
                  "type": "string",
                  "minLength": 1,
                  "maxLength": 100,
                  "pattern": "^[a-zA-Z\\s\\-'\\p{L}\\p{M}]+$",
                  "description": "The name of the book's author",
                  "example": "John Doe"
               },
               "author_bio": {
                  "type": "string",
                  "nullable": true,
                  "maxLength": 1000,
                  "description": "Optional biography of the author",
                  "example": "An accomplished writer with multiple bestsellers"
               }
            },
            "required": [
               "title",
               "pub_year",
               "genre",
               "author_name"
            ],
            "additionalProperties": false,
            "description": "Schema for creating a new book record",
            "title": "BookCreate"
         },
         "BookUpdate": {
            "type": "object",
            "properties": {
               "id": {
                  "type": "integer",
                  "minimum": -9007199254740991,
                  "maximum": 9007199254740991
               },
               "author_id": {
                  "type": "integer",
                  "minimum": -9007199254740991,
                  "maximum": 9007199254740991
               },
               "title": {
                  "type": "string",
                  "minLength": 1,
                  "maxLength": 200,
                  "description": "The title of the book",
                  "example": "The Great Gatsby"
               },
               "pub_year": {
                  "type": "string",
                  "maxLength": 4,
                  "pattern": "^\\d{4}$",
                  "description": "The year the book was published",
                  "example": "2023"
               },
               "genre": {
                  "type": "string",
                  "minLength": 1,
                  "description": "The genre of the book",
                  "example": "Fiction",
                  "enum": [
                     "Fiction",
                     "Non-Fiction",
                     "Mystery",
                     "Science Fiction",
                     "Fantasy",
                     "Romance",
                     "Thriller",
                     "Horror",
                     "Biography",
                     "History",
                     "Science",
                     "Poetry",
                     "Drama",
                     "Children"
                  ]
               },
               "author_name": {
                  "type": "string",
                  "minLength": 1,
                  "maxLength": 100,
                  "pattern": "^[a-zA-Z\\s\\-'\\p{L}\\p{M}]+$",
                  "description": "The updated name of the book's author",
                  "example": "Jane Smith"
               },
               "author_bio": {
                  "type": "string",
                  "nullable": true,
                  "maxLength": 1000,
                  "description": "Updated biography of the author",
                  "example": "Award-winning author of contemporary fiction"
               }
            },
            "additionalProperties": false,
            "description": "Schema for updating an existing book record",
            "title": "BookUpdate"
         },
         "Author": {
            "type": "object",
            "properties": {
               "id": {
                  "type": "integer",
                  "minimum": -9007199254740991,
                  "maximum": 9007199254740991
               },
               "name": {
                  "type": "string"
               },
               "bio": {
                  "type": "string",
                  "nullable": true
               }
            },
            "required": [
               "id",
               "name",
               "bio"
            ],
            "description": "Complete author record with all properties",
            "title": "Author"
         },
         "AuthorCreate": {
            "type": "object",
            "properties": {
               "id": {
                  "type": "integer",
                  "minimum": -9007199254740991,
                  "maximum": 9007199254740991
               },
               "name": {
                  "type": "string",
                  "minLength": 1,
                  "maxLength": 100,
                  "pattern": "^[a-zA-Z\\s\\-'\\p{L}\\p{M}]+$",
                  "description": "Author's full name",
                  "example": "Jane Austen"
               },
               "bio": {
                  "type": "string",
                  "nullable": true,
                  "maxLength": 1000,
                  "description": "Author's biographical information",
                  "example": "A renowned author known for her works in classic literature"
               }
            },
            "required": [
               "name"
            ],
            "additionalProperties": false,
            "description": "Schema for creating a new author record",
            "title": "AuthorCreate"
         },
         "AuthorUpdate": {
            "type": "object",
            "properties": {
               "id": {
                  "type": "integer",
                  "minimum": -9007199254740991,
                  "maximum": 9007199254740991
               },
               "name": {
                  "type": "string",
                  "minLength": 1,
                  "maxLength": 100,
                  "pattern": "^[a-zA-Z\\s\\-'\\p{L}\\p{M}]+$",
                  "description": "Author's full name",
                  "example": "Jane Austen"
               },
               "bio": {
                  "type": "string",
                  "nullable": true,
                  "maxLength": 1000,
                  "description": "Author's biographical information",
                  "example": "A renowned author known for her works in classic literature"
               }
            },
            "additionalProperties": false,
            "description": "Schema for updating an existing author record",
            "title": "AuthorUpdate"
         }
      },
      "parameters": {}
   },
   "paths": {
      "/books": {
         "get": {
            "description": "Get all books with optional filtering",
            "tags": [
               "Books"
            ],
            "parameters": [
               {
                  "schema": {
                     "type": "string",
                     "description": "Search by book title (partial match)",
                     "example": "Gatsby"
                  },
                  "required": false,
                  "name": "title",
                  "in": "query"
               },
               {
                  "schema": {
                     "type": "string",
                     "description": "Filter by genre",
                     "example": "Fiction",
                     "enum": [
                        "Fiction",
                        "Non-Fiction",
                        "Mystery",
                        "Science Fiction",
                        "Fantasy",
                        "Romance",
                        "Thriller",
                        "Horror",
                        "Biography",
                        "History",
                        "Science",
                        "Poetry",
                        "Drama",
                        "Children"
                     ]
                  },
                  "required": false,
                  "name": "genre",
                  "in": "query"
               },
               {
                  "schema": {
                     "type": "string",
                     "pattern": "^\\d{4}$",
                     "description": "Filter by publication year",
                     "example": "2023"
                  },
                  "required": false,
                  "name": "pub_year",
                  "in": "query"
               }
            ],
            "responses": {
               "200": {
                  "description": "List of books matching the criteria",
                  "content": {
                     "application/json": {
                        "schema": {
                           "type": "array",
                           "items": {
                              "allOf": [
                                 {
                                    "$ref": "#/components/schemas/Book"
                                 },
                                 {
                                    "type": "object",
                                    "properties": {
                                       "name": {
                                          "type": "string",
                                          "minLength": 1,
                                          "maxLength": 100,
                                          "pattern": "^[a-zA-Z\\s\\-'\\p{L}\\p{M}]+$",
                                          "description": "Author's full name",
                                          "example": "Jane Austen"
                                       }
                                    },
                                    "required": [
                                       "name"
                                    ]
                                 }
                              ],
                              "description": "A book record with all its properties",
                              "title": "Book"
                           }
                        }
                     }
                  }
               }
            }
         },
         "post": {
            "description": "Create a new book",
            "tags": [
               "Books"
            ],
            "requestBody": {
               "content": {
                  "application/json": {
                     "schema": {
                        "$ref": "#/components/schemas/BookCreate"
                     }
                  }
               }
            },
            "responses": {
               "201": {
                  "description": "Book created successfully",
                  "content": {
                     "application/json": {
                        "schema": {
                           "$ref": "#/components/schemas/Book"
                        }
                     }
                  }
               },
               "400": {
                  "description": "Invalid request body"
               }
            }
         }
      },
      "/books/{id}": {
         "get": {
            "description": "Get a book by its ID",
            "tags": [
               "Books"
            ],
            "parameters": [
               {
                  "schema": {
                     "type": "number",
                     "minimum": 0,
                     "exclusiveMinimum": true
                  },
                  "required": true,
                  "name": "id",
                  "in": "path"
               }
            ],
            "responses": {
               "200": {
                  "description": "Book details",
                  "content": {
                     "application/json": {
                        "schema": {
                           "$ref": "#/components/schemas/Book"
                        }
                     }
                  }
               },
               "404": {
                  "description": "Book not found"
               }
            }
         },
         "put": {
            "description": "Update an existing book",
            "tags": [
               "Books"
            ],
            "parameters": [
               {
                  "schema": {
                     "type": "number",
                     "minimum": 0,
                     "exclusiveMinimum": true
                  },
                  "required": true,
                  "name": "id",
                  "in": "path"
               }
            ],
            "requestBody": {
               "content": {
                  "application/json": {
                     "schema": {
                        "$ref": "#/components/schemas/BookUpdate"
                     }
                  }
               }
            },
            "responses": {
               "200": {
                  "description": "Book updated successfully",
                  "content": {
                     "application/json": {
                        "schema": {
                           "$ref": "#/components/schemas/Book"
                        }
                     }
                  }
               },
               "400": {
                  "description": "Invalid request body"
               },
               "404": {
                  "description": "Book not found"
               }
            }
         },
         "delete": {
            "description": "Delete a book",
            "tags": [
               "Books"
            ],
            "parameters": [
               {
                  "schema": {
                     "type": "number",
                     "minimum": 0,
                     "exclusiveMinimum": true
                  },
                  "required": true,
                  "name": "id",
                  "in": "path"
               }
            ],
            "responses": {
               "204": {
                  "description": "Book deleted successfully"
               },
               "404": {
                  "description": "Book not found"
               }
            }
         }
      },
      "/authors": {
         "get": {
            "description": "Get all authors",
            "tags": [
               "Authors"
            ],
            "parameters": [
               {
                  "schema": {
                     "type": "string",
                     "description": "Search by author name (partial match)",
                     "example": "Jane"
                  },
                  "required": false,
                  "name": "name",
                  "in": "query"
               },
               {
                  "schema": {
                     "type": "string",
                     "description": "Search within author biography (partial match)",
                     "example": "award-winning"
                  },
                  "required": false,
                  "name": "bio",
                  "in": "query"
               }
            ],
            "responses": {
               "200": {
                  "description": "Success",
                  "content": {
                     "application/json": {
                        "schema": {
                           "type": "array",
                           "items": {
                              "$ref": "#/components/schemas/Author"
                           }
                        }
                     }
                  }
               }
            }
         },
         "post": {
            "description": "Create an author",
            "tags": [
               "Authors"
            ],
            "requestBody": {
               "content": {
                  "application/json": {
                     "schema": {
                        "$ref": "#/components/schemas/AuthorCreate"
                     }
                  }
               }
            },
            "responses": {
               "201": {
                  "description": "Created",
                  "content": {
                     "application/json": {
                        "schema": {
                           "$ref": "#/components/schemas/Author"
                        }
                     }
                  }
               },
               "409": {
                  "description": "Author already exists!"
               }
            }
         }
      },
      "/authors/{id}": {
         "get": {
            "description": "Get author by id",
            "tags": [
               "Authors"
            ],
            "parameters": [
               {
                  "schema": {
                     "type": "number",
                     "minimum": 0,
                     "exclusiveMinimum": true
                  },
                  "required": true,
                  "name": "id",
                  "in": "path"
               }
            ],
            "responses": {
               "200": {
                  "description": "Success",
                  "content": {
                     "application/json": {
                        "schema": {
                           "$ref": "#/components/schemas/Author"
                        }
                     }
                  }
               },
               "404": {
                  "description": "Not found"
               }
            }
         },
         "put": {
            "description": "Update an author",
            "tags": [
               "Authors"
            ],
            "parameters": [
               {
                  "schema": {
                     "type": "number",
                     "minimum": 0,
                     "exclusiveMinimum": true
                  },
                  "required": true,
                  "name": "id",
                  "in": "path"
               }
            ],
            "requestBody": {
               "content": {
                  "application/json": {
                     "schema": {
                        "$ref": "#/components/schemas/AuthorUpdate"
                     }
                  }
               }
            },
            "responses": {
               "200": {
                  "description": "Success",
                  "content": {
                     "application/json": {
                        "schema": {
                           "$ref": "#/components/schemas/Author"
                        }
                     }
                  }
               },
               "404": {
                  "description": "Not found"
               }
            }
         },
         "delete": {
            "description": "Delete an author",
            "tags": [
               "Authors"
            ],
            "parameters": [
               {
                  "schema": {
                     "type": "number",
                     "minimum": 0,
                     "exclusiveMinimum": true
                  },
                  "required": true,
                  "name": "id",
                  "in": "path"
               }
            ],
            "responses": {
               "200": {
                  "description": "Success",
                  "content": {
                     "application/json": {
                        "schema": {
                           "type": "object",
                           "properties": {
                              "deleted_id": {
                                 "type": "number"
                              }
                           },
                           "required": [
                              "deleted_id"
                           ],
                           "description": "Response containing the ID of the deleted author",
                           "title": "DeletedAuthor"
                        }
                     }
                  }
               },
               "404": {
                  "description": "Not found"
               },
               "409": {
                  "description": "Author is a dependency, cannot be deleted!"
               }
            }
         }
      }
   }
}